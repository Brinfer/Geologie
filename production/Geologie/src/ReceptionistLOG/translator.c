/**
 * @file translator.c
 *
 * @version 1.0
 * @date 5 mai 2021
 * @author GAUTIER Pierre-Louis
 * @copyright BSD 2-clauses
 *
 */

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//                                              Include
//
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#include "translator.h"
#include "Geographer/geographer.h"

#include <stdint.h>
#include <stdlib.h>
#include <string.h>

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//                                              Define
//
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


static void convertToMSB(unsigned char array[], unsigned int size);
static void convertFloatToBytes(float f, unsigned char dest[]);
static void convertDoubleToBytes(double d, unsigned char dest[]);

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//                                              Variable et structure extern
//
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//                                              Fonctions publiques
//
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

extern int TRANSLATOR_convertPosition(const Position* position, unsigned char dest[8]) {
    int returnValue = EXIT_FAILURE;
    unsigned char tempArray[4];
    convertFloatToBytes(position->X, tempArray);
    convertToMSB(tempArray, 4);
    ARRAY_CONCATENATE(tempArray, dest, 0, 4);

    convertFloatToBytes(position->Y, tempArray);
    convertToMSB(tempArray, 4);
    ARRAY_CONCATENATE(tempArray, dest, 4, 8);

    return returnValue;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//                                              Fonctions static
//
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void convertToMSB(unsigned char array[], unsigned int size) {
    for (int i = 0; i < size / 2; i++) {
        unsigned char temp = array[i];
        array[i] = array[size - 1 - i];
        array[size - 1 - i] = temp;
    }
}

static void convertFloatToBytes(float f, unsigned char dest[]) {
    memcpy(dest, (unsigned char*) (&f), sizeof(float));
}

static void convertDoubleToBytes(double d, unsigned char dest[]) {
    memcpy(dest, (unsigned char*) (&d), sizeof(double));
}
